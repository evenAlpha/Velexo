import{w as G}from"./with-props-bezBRlDp.js";import{j as e}from"./jsx-runtime-BjG_zV1W.js";import{q as P,t as U,r as n}from"./chunk-KNED5TY2-DK4LrZ4V.js";import{c as p}from"./client-DlwxUW1z.js";import{S as x,a as m,b as u,c as j,C as T,d as f}from"./types-CDElO9BJ.js";import{C as W,a as $}from"./card-aNYpyC57.js";import{c as i}from"./utils-DjqsqOe8.js";import{B as k}from"./button-CN2Ei1bR.js";import"./index-DezlXQ_q.js";import"./index-D1l7H5IR.js";function z({className:l,...t}){return e.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:e.jsx("table",{"data-slot":"table",className:i("w-full caption-bottom text-sm",l),...t})})}function J({className:l,...t}){return e.jsx("thead",{"data-slot":"table-header",className:i("[&_tr]:border-b",l),...t})}function K({className:l,...t}){return e.jsx("tbody",{"data-slot":"table-body",className:i("[&_tr:last-child]:border-0",l),...t})}function _({className:l,...t}){return e.jsx("tr",{"data-slot":"table-row",className:i("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",l),...t})}function D({className:l,...t}){return e.jsx("th",{"data-slot":"table-head",className:i("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",l),...t})}function L({className:l,...t}){return e.jsx("td",{"data-slot":"table-cell",className:i("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",l),...t})}const M={level:{1:"#ffff00",2:"#ffa500",3:"#00ff00",4:"#0000ff",5:"#800080"}},re=async({request:l})=>{const t=p(),{data:r,error:o}=await t.auth.getUser();return o||!(r!=null&&r.user)?P("/login"):r.user},ne=G(function(){var C,N,S,y;const t=U(),[r,o]=n.useState([]),[E,I]=n.useState([]),[b,V]=n.useState(null),[g,q]=n.useState(""),[w,B]=n.useState(""),[v,F]=n.useState(""),A=T.public.Enums.craft,H=T.public.Enums.level;n.useEffect(()=>{async function s(){const c=p(),{data:d}=await c.from("situation").select(`
          *,
          theme:theme(*),
          author:author(*)
        `),{data:h}=await c.from("themes").select("*");o(d??[]),I(h??[])}s()},[]);const R=r.filter(s=>{const c=!g||(s.crafts??[]).includes(g),d=!v||s.level===v,h=!w||s.theme&&String(s.theme.id)===w;return c&&d&&h}),a=r.find(s=>s.id===b);return e.jsx(W,{className:"m-4",children:e.jsxs($,{children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 gap-4 flex-wrap",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Situations"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(x,{onValueChange:q,children:[e.jsx(m,{className:"w-[150px]",children:e.jsx(u,{placeholder:"Craft"})}),e.jsx(j,{children:A.map(s=>e.jsx(f,{value:s,children:s},s))})]}),e.jsxs(x,{onValueChange:F,children:[e.jsx(m,{className:"w-[100px]",children:e.jsx(u,{placeholder:"Level"})}),e.jsx(j,{children:H.map(s=>e.jsx(f,{value:s,children:s},s))})]}),e.jsxs(x,{onValueChange:B,children:[e.jsx(m,{className:"w-[180px]",children:e.jsx(u,{placeholder:"Theme"})}),e.jsx(j,{children:E.map(s=>s?e.jsx(f,{value:String(s.id),children:s.name},s.id):null)})]})]})]}),e.jsxs(z,{children:[e.jsx(J,{children:e.jsxs(_,{children:[e.jsx(D,{children:"Title"}),e.jsx(D,{children:"Goal"})]})}),e.jsx(K,{children:R.map(s=>e.jsxs(_,{onClick:()=>V(b===s.id?null:s.id),className:"cursor-pointer",children:[e.jsx(L,{children:s.title}),e.jsx(L,{children:s.goal})]},s.id))})]}),a&&e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Details"}),e.jsxs("ul",{className:"text-sm space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Description:"})," ",((C=a.description)==null?void 0:C.slice(0,50))||"—"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Level:"})," ",e.jsx("span",{className:"px-2 py-1 rounded",style:{backgroundColor:M.level[a.level??"1"]},children:a.level})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Wind:"})," ",a.wind_min," - ",a.wind_max]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sea:"})," ",a.sea_min," - ",a.sea_max]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Crafts:"})," ",(a.crafts??[]).join(", ")||"—"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Crews:"})," ",(a.crews??[]).join(", ")||"—"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Theme:"})," ",((N=a.theme)==null?void 0:N.name)??"—"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Author:"})," ",((S=a.author)==null?void 0:S.name)??"—"]})]}),(t==null?void 0:t.id)===((y=a.author)==null?void 0:y.id)&&e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(k,{variant:"secondary",onClick:()=>window.location.assign(`/situations/edit/${a.id}`),children:"Edit"}),e.jsx(k,{variant:"destructive",onClick:()=>{confirm("Are you sure you want to delete this situation?")&&p().from("situation").delete().eq("id",a.id).then(()=>window.location.reload())},children:"Delete"})]})]})]})})});export{re as clientLoader,ne as default};
